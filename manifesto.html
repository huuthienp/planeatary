<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet" />
        <link href="style_concat.css" rel="stylesheet" />
        <title>Start Challenges</title>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1 class="logo">planeatary - logo</h1>
                    <nav>
                         <ul style="font-family: Poppins;">
                            <li>Home</li>
                            <li>
                                <a href="qualtrics.html"><b>Quiz</b></a>
                            </li>
                            <li><a href="manifesto.html">Challenge</a></li>
                            <li>About us</li>
                        </ul>
                    </nav>
                    <div class="button">
                        <button class="signIn">Sign In</button>
                        <span>&ensp;</span>
                        <button class="signUp">Sign Up</button>
                    </div>
            </div>
            <div class="subheader">
                <p id="tentask">Youâ€™ve selected 10 tasks. Start challenge now</p>
            </div>
            <div class="button2">
                <button class="start"><a href="challenge_page.html">Start</a></button>
            </div>
            <div class="improvement">
                <button id="good">Good scores</button>
                <button id="notyet">Need improvement</button>
            </div>
            <div class="task-content">
                <div class="q-task">

                    <!--<ul id="q2">
                        <li>
                            <p>Question <span id="q_num2"></span> - <span id="q_score2"></span><img src="./images/info.png" onclick="Modal();" /></p>
                        </li>
                        <li>
                            <lable>
                                <input  type="checkbox" name="task" value="Living"/> Eat to live or live to eat
                            </label>
                            <img src="./images/info2.png" onclick="Modal();" />
                        </li>
                        <li>
                            <label>
                                <input  type="checkbox" name="task" value="Blackpink"/> Don't know what to do without you
                            </label>
                            <img src="./images/info2.png" onclick="Modal();" />
                        </li>
                        <li>
                            <label>
                                <input  type="checkbox" name="task" value="Deadline"/> Don't do if we can finish by the deadline
                            </label>
                            <img src="./images/info2.png" onclick="Modal();" />
                        </li>
                    </ul>-->
                </div>
            </div>
        </div>
        <!-- The Modal -->
        <section class="overlay hidden">
                <div class="align">
                    <div class="modal hidden"> 
                        <div class="btn">
                            <button class="close" onclick="Close();">x</button>
                        </div>
                        <div class="modal-content">
                            <img />
                        </div>
                    </div>
                <div>
        </section>
        <script>
            function Modal() {
                // Get the modal
                var modal = document.querySelector(".modal");
                var overlay = document.querySelector(".overlay");
                var info = document.querySelector('.modal-content');
                modal.classList.remove('hidden');
                overlay.classList.remove('hidden');
            }
            // When the user clicks on <span> (x), close the modal
            function Close() {
                var modal = document.querySelector(".modal");
                var overlay = document.querySelector(".overlay");
                modal.classList.add("hidden");
                overlay.classList.add('hidden');
            }
            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
                const modal = document.querySelector(".modal");
                const overlay = document.querySelector(".overlay");
                if (event.target == modal) {
                    modal.classList.add("hidden");
                    overlay.classList.add("hidden"); 
                }
            }
            const good = document.querySelector("#good");
            const bad = document.querySelector("#notyet");
            const QContainer = document.querySelector(".q-task");
            document.addEventListener("DOMContentLoaded", function() {
                let scores = [];
                let tasks = [];
                // Check if scores are stored in localStorage
                const storedScore = localStorage.getItem("user");
                if (storedScore) {
                    // Parse and use scores from localStorage
                    scores = JSON.parse(storedScore);
                    tasks = scores.tasks || [];
                } else {
                    // Fetch score from 'before_user.json' and store them in localStorage
                    fetch('before_user.json')
                        .then(response => response.json())
                        .then(data => {
                            if (data.postscore) {
                                scores = data.postscore;
                            }
                            else {
                                scores = data.prescore;
                            }
                            tasks = scores.tasks || [];
                            localStorage.setItem("user", JSON.stringify(scores));

                        })
                        .catch(error => console.error("Error fetching JSON data:", error));
            };

            good.addEventListener('click', function () {
                QContainer.innerHTML = ''; // Clear any existing content
                scores.forEach((score, i) => {
                    if (score.score > 3) {
                        const q_con = document.createElement("ul");
                        q_con.classList.add("q");
                
                        const question = document.createElement("li");
                        question.id = `q_num${i+1}`;
                
                        const q_num = document.createElement("span")
                        q_num.textContent = `Question ${i+1} - ${score.score} points`;
                        
                        const info = document.createElement("img");
                        info.src = "./images/info.png";
                        info.style.width = "5%";
                        info.alt = "Info Icon";

                        q_con.appendChild(question);
                        question.appendChild(q_num);

                        const tasks = score.tasks;
                        tasks.forEach((task, j) => {
                            const q_input = document.createElement("li");
                            const label = document.createElement("label");
                            const input = document.createElement("input");
                            const text = document.createElement("span");
                            text.innerHTML = task.taskName; 
                            input.type = "checkbox";
                            label.appendChild(input); 
                            label.appendChild(text); 
                            q_input.appendChild(label); 
                            q_con.appendChild(q_input); 
                            task.choice = task.choice || "not selected";
                            // Event listener to track selection
                            input.addEventListener('change', function() {
                                if (input.checked) {
                                    task.choice = "selected"; // Mark task as selected if checked
                                } else {
                                    task.choice = "not selected"; // Mark task as not selected if unchecked
                                }
                                console.log(`Task: ${task.taskName}, Choice: ${task.choice}`); // Debugging
                                localStorage.setItem("user", JSON.stringify(scores));
                            });
                        });

                        info.addEventListener('click', Modal); 
                        question.appendChild(info);
                        QContainer.appendChild(q_con);
                    }
                })
            });
            bad.addEventListener('click', function () {
                QContainer.innerHTML = ''; // Clear any existing content
                scores.forEach((score, i) => {
                    if (score.score <= 3) {
                        const q_con = document.createElement("ul");
                        q_con.classList.add("q");
                
                        const question = document.createElement("li");
                        question.id = `q_num${i+1}`;
                
                        const q_num = document.createElement("span")
                        q_num.textContent = `Question ${i+1} - ${score.score} points`;
                        const info = document.createElement("img");
                        info.src = "./images/info.png";
                        info.style.width = "5%";
                        info.alt = "Info Icon";
                        info.addEventListener('click', Modal); 

                        
                        q_con.appendChild(question);
                        question.appendChild(q_num);

                        const tasks = score.tasks;
                        tasks.forEach((task, j) => {
                            const q_input = document.createElement("li");
                            const label = document.createElement("label");
                            const input = document.createElement("input");
                            const text = document.createElement("span");
                            text.innerHTML = task.taskName; 
                            input.type = "checkbox";
                            label.appendChild(input); 
                            label.appendChild(text); 
                            q_input.appendChild(label); 
                            q_con.appendChild(q_input); 
                            task.choice = task.choice || "not selected";
                            // Event listener to track selection
                            input.addEventListener('change', function() {
                                if (input.checked) {
                                    task.choice = "selected"; // Mark task as selected if checked
                                } else {
                                    task.choice = "not selected"; // Mark task as not selected if unchecked
                                }
                                console.log(`Task: ${task.taskName}, Choice: ${task.choice}`); // Debugging
                                localStorage.setItem("user", JSON.stringify(scores));
                            });
                        });

                        question.appendChild(info);
                        QContainer.appendChild(q_con);
                    }
                })
            });
        })
        </script>
    </body>
</html>
